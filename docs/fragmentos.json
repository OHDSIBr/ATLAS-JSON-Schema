      "allOf":[{"$ref":"#/definitions/EndStrategy"}],
      "required":["drugCodesetId","GapDays","Offset"],


{
  "EndStrategy": {
    "drugCodesetId": "null",
    "GapDays": 0,
    "Offset": 0
  }
}

        "additionalProperties": false,
      "oneOf":[
          {"title":"end of a continuous drug exposure ","type":"object","$ref":"#/definitions/CustomEraStrategy"},
          {"title":"fixed duration relative to initial event ","$ref":"#/definitions/DateOffsetStrategy"}
      ]
      "required":["DateField"],
      "required":["GapDays"],
      "options": {
        "remove_empty_properties": true
      },

        "expression":{"type":"object","properties":{"items":{"$ref":"#/definitions/RulesType"}}}
    "ConceptSetsType":{"$ref":"/docs/ConceptSetsType.json"},
    "ConceptType":{"$ref":"/docs/ConceptType.json"},


{
  "$id": "http://example.com/blah/root.json",
  "definitions": {
    "ConceptType": {
      "type": "object",
      "$id":"ConceptType",
      "title":"Concept",
      "aditionalProperties":"false",
      "required":["CONCEPT_ID", "CONCEPT_NAME", "STANDARD_CONCEPT_CAPTION", "INVALID_REASON_CAPTION", "STANDARD_CONCEPT", "INVALID_REASON", "CONCEPT_CODE", "DOMAIN_ID", "VOCABULARY_ID", "CONCEPT_CLASS_ID" ],
      "properties": {
        "CONCEPT_ID":{"type":"integer"},
        "CONCEPT_NAME":{"type":"string","maxLength": 255},
        "STANDARD_CONCEPT_CAPTION":{
          "type":"string",
          "default": "Standard",
          "enum":["Standard","Classification","Non-Standard",""],
          "options":{
            "enum_titles":["Standard","Classification","Non-Standard","Unknown"]
          }
        },
        "STANDARD_CONCEPT":{
          "type":"string",
          "maxLength": 1,
          "readOnly":true,
          "watch":{
            "stdc":"arr_item.concept.STANDARD_CONCEPT_CAPTION"
          },
        "options": {
          "hidden": true
        },
          "enumSource": "stdc"
        },
        "INVALID_REASON_CAPTION":{
          "type":"string",
          "default": "Valid",
          "enum":["Valid","Deleted","Upgraded",""],
          "options":{
            "enum_titles":["Valid","Deleted","Upgraded","Unknown"]
          }
        },
        "INVALID_REASON":{
          "type":"string",
          "maxLength": 1,
          "options": {
            "hidden": true
          },
          "readOnly":true,
          "watch":{
            "irc":"arr_item.concept.INVALID_REASON_CAPTION"
          },
          "enumSource": "irc"
        },
        "CONCEPT_CODE":{"type":"string","maxLength": 50},
        "DOMAIN_ID":{"type":"string","maxLength": 20},
        "VOCABULARY_ID":{"type":"string","maxLength": 20},
        "CONCEPT_CLASS_ID":{"type":"string","maxLength": 20}
      }
    },
    "ConceptSetsType": {
      "$id":"#ConceptSetsType",
      "type": "array",
      "items":{
        "id": "arr_item",
        "title":"Concept Element",
        "required":["concept","includeDescendants","includeMapped"],
        "properties":{
          "concept":{
      "$ref": "http://example.com/blah/ConceptType"},
          "includeDescendants": {"type":"boolean","title":"Include Descendants"},
          "includeMapped": {"type":"boolean","title":"Include Mapped"}
        }
      }
    }
  },
  "items":{
   "properties":{
    "name":{"type":"string"},
    "expression": { "$ref": "#/definitions/ConceptSetsType" }
  }
  }
}  
    "name": {"$ref":"/docs/generalOptions.json#/properties/dayOptions"},
    "age": {"$ref":"/docs/generalOptions.json#/properties/dayOptionsInteger"},

    "dayOptions":{
      "type":"string",
      "enum":[ "0", "1", "7", "14", "21", "30", "60", "90", "120", "180", "365", "548", "730", "1095"],
      "options":{
        "enum_titles":[ "zero", "um dia", "uma semana", "14", "21", "30", "60", "90", "120", "180", "365", "548", "730", "1095"]
      }
    },
    "dayOptionsInteger":{"$ref":"#/definitions/dayOptionsIntegerPlus"},
    "dayOptionsIntegerPlus":{
      "type":"integer",
      "enum":[ 0, 1, 7, 14, 21, 30, 60, 90, 120, 180, 365, 548, 730, 1095],
      "options":{
        "enum_titles":[ "zero", "um dia", "uma semana", "14", "21", "30", "60", "90", "120", "180", "365", "548", "730", "1095"]
      }
    },

,
      "StartWindow":{
            "type": "object",
            "$ref":"#/definitions/WindowType"
        },
      "EndWindow":{
            "type": "object",
            "$ref":"#/definitions/WindowType"
        },
      "Occurrence":{}



      "$ref" : "docs/core/codeset_id_type.json"


      "$ref" : "docs/core/codeset_id_type.json"

      ,
        "CodesetId":{"$ref":"#/definitions/CodesetIdType"}

        ,
    "CodesetIdType":{
        "$ref" : "docs/core/codeset_id_type.json"      }

        "CodesetId":{"$ref":"#/definitions/CodesetIdType"}
{
      "$ref":"http://localhost:8080/atlasTestConceptsRefs.json"
}
,
    "Codesets": {
      "type":"array",
      "items":{
        "properties":{
        "id":{"type":"integer"},
        "name":{"type":"string"},
        "expression":{"type":"object","properties":{"items":{"$ref":"#/definitions/ConceptSetsType"}}}
        
        }
      }
    }

    "ConceptSetsOld": {"$ref":"#/definitions/Codesets"},

    {
      "$schema": "http://json-schema.org/draft-04/schema#",
      "$id":"ConceptSet",
      "type": "array",
      "items":{
        "id": "arr_item",
        "title":"Concept Element",
        "format":"grid-strict",
        "headerTemplate": "{{ i1 }} - {{ self.concept.CONCEPT_NAME }}: {{ self.concept.DOMAIN_ID }}",
        "required":["concept","isExcluded","includeDescendants","includeMapped"],
        "defaultProperties":["concept","isExcluded","includeDescendants","includeMapped"],
        "type":"object",
        "additionalProperties":false,
        "options": {
          "disable_edit_json":true,
          "disable_properties":true,
          "display_required_only":true,
          "no_additional_properties":true
        },
          "properties":{
                "concept":{"$ref":"core/concept_core_extended.json"},
                "isExcluded":{"type":"boolean","format": "checkbox","default":false,"title":"Exclude Concept","options": {"grid_columns": 4}},
                "includeDescendants": {"type":"boolean","format": "checkbox","title":"Include Descendants","options": {"grid_columns": 4}},
                "includeMapped": {"type":"boolean","format": "checkbox","title":"Include Mapped","options": {"grid_columns": 4}}
        }
      }
    }

    
    {
      "type": "array",
      "format": "tabs",
      "description": "Frequent Questions",
      "items": {
          "title": "FAQ",
          "id": "FAQItem",
          "headerTemplate": "{{i}} - {{self.Category}}",
          "type": "object",
              "properties": {
                "FAQ_ID": {
                    "type": "string",
                    "format": "hidden",
                    "headerTemplate": " ",
                    "template": "{{myVar}}",
                    "watch": {
                        "myVar": "FAQItem.i"
                    }
                },
                "Category": {
                  "type": "string"
                },
                "Text": {
                    "type": "string",
                    "format": "textarea"
                }
              }
      }
}


{
  "type": "array",
  "format": "tabs",
  "description": "Frequent Questions",
  "items": {
      "title": "FAQ",
      "id": "FAQItem",
      "headerTemplate": "{{i}} - {{self.Category}}",
      "type": "object",
          "properties": {
            "FAQ_ID": {
                "type": "integer",
                "default":"{{i}}"
            },
            "Category": {
              "type": "string"
            }
          }
  }
}

//codeset_id_type
{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "integer",
  "watch": {
    "concepts": "ConceptSets"
  },
  "enumSource": [
    {"source":[null],"title": "Any","value": null},
    {
      "source": "concepts",
      "title": "{{item.name}}",
      "value": "{{item.id}}"
    }
  ]
}

//Alternating string and number
{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "anyOf":[
    {"type": "string","title": "Any concept","value":""},
    {
      "type": "integer","title": "one of:",
      "watch": {
        "concepts": "ConceptSets"
      },
      "enumSource": [
        {
          "source": "concepts",
          "title": "{{item.name}}",
          "value": "{{item.id}}"
        }
      ]
    }
  ]
}

//Alternating null and number
{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "anyOf":[
    {"type": "null","title": "Any concept"},
    {
      "type": "integer","title": "one of:",
      "watch": {
        "concepts": "ConceptSets"
      },
      "enumSource": [
        {
          "source": "concepts",
          "title": "{{item.name}}",
          "value": "{{item.id}}"
        }
      ]
    }
  ]
}
,"CriteriaList","DemographicCriteriaList","Groups"

"title":"of the following criteria:",
"description":"of the following criteria: ",
"description":"(Use Properties button to add criterias.)",
"options":{"array_controls_top":true,"disable_edit_json":true,"disable_properties":true},
"default":{"$ref":"condition_era_criteria.json"},
,"description":"Limit Condition Occurrences to new diagnosis."

"OccurrenceCount" : {"title":"Add Condition Count Criteria","headerTemplate":"with ocurrence count: ","description":"Filter Condition Eras by the Condition Count.","$ref" : "NumericRange.json",
  "options": {"disable_collapse":false,"disable_properties":true,"disable_edit_json":true}},
"EraLength" : {"title":"Add Era Length Criteria","headerTemplate":"with era length: ","description":"Filter Condition Eras by Era duration.","$ref" : "NumericRange.json",
  "options": {"disable_collapse":false,"disable_properties":true,"disable_edit_json":true}},



  {
    "ConceptSets": [
      {
        "id": 0,
        "name": "aspirin mono",
        "expression": {
          "items": [
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370614",
                "CONCEPT_ID": 40009842,
                "CONCEPT_NAME": "Aspirin Chewable Tablet",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370942",
                "CONCEPT_ID": 40009849,
                "CONCEPT_NAME": "Aspirin Chewing Gum",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "405802",
                "CONCEPT_ID": 40009855,
                "CONCEPT_NAME": "Aspirin Delayed Release Oral Capsule",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370939",
                "CONCEPT_ID": 40009857,
                "CONCEPT_NAME": "Aspirin Delayed Release Oral Tablet",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "379422",
                "CONCEPT_ID": 40009853,
                "CONCEPT_NAME": "Aspirin Disintegrating Oral Tablet",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "1537020",
                "CONCEPT_ID": 44818011,
                "CONCEPT_NAME": "Aspirin Effervescent Oral Tablet",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "376394",
                "CONCEPT_ID": 40009875,
                "CONCEPT_NAME": "Aspirin Extended Release Oral Capsule",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370612",
                "CONCEPT_ID": 40009878,
                "CONCEPT_NAME": "Aspirin Extended Release Oral Tablet",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370940",
                "CONCEPT_ID": 40009890,
                "CONCEPT_NAME": "Aspirin Oral Capsule",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "437673",
                "CONCEPT_ID": 40009889,
                "CONCEPT_NAME": "Aspirin Oral Lozenge",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "379497",
                "CONCEPT_ID": 40009891,
                "CONCEPT_NAME": "Aspirin Oral Powder",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "375972",
                "CONCEPT_ID": 40009892,
                "CONCEPT_NAME": "Aspirin Oral Solution",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "1535483",
                "CONCEPT_ID": 44817822,
                "CONCEPT_NAME": "Aspirin Oral Strip",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370611",
                "CONCEPT_ID": 40009896,
                "CONCEPT_NAME": "Aspirin Oral Tablet",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            },
            {
              "concept": {
                "CONCEPT_CLASS_ID": "Clinical Drug Form",
                "CONCEPT_CODE": "370609",
                "CONCEPT_ID": 40010213,
                "CONCEPT_NAME": "Aspirin Rectal Suppository",
                "DOMAIN_ID": "Drug",
                "INVALID_REASON": "V",
                "INVALID_REASON_CAPTION": "Valid",
                "STANDARD_CONCEPT": "S",
                "STANDARD_CONCEPT_CAPTION": "Standard",
                "VOCABULARY_ID": "RxNorm"
              },
              "includeDescendants": true,
              "includeMapped": true
            }
          ]
        }
      }
    ],
    "PrimaryCriteria": {
      "CriteriaList": [
        {
          "ConditionEra": {
            "CorrelatedCriteria": {
              "Type": "ALL",
              "CriteriaList": [
                {
                  "Criteria": {
                    "DeviceExposure": {}
                  },
                  "StartWindow": {
                    "Start": {
                      "Coeff": -1
                    },
                    "End": {
                      "Coeff": 1
                    },
                    "UseEventEnd": false
                  },
                  "RestrictVisit": true,
                  "IgnoreObservationPeriod": true,
                  "Occurrence": {
                    "Type": 2,
                    "Count": 1
                  }
                },
                {
                  "Criteria": {
                    "DrugEra": {}
                  },
                  "StartWindow": {
                    "Start": {
                      "Coeff": -1
                    },
                    "End": {
                      "Coeff": 1
                    },
                    "UseEventEnd": false
                  },
                  "IgnoreObservationPeriod": true,
                  "Occurrence": {
                    "Type": 2,
                    "Count": 1
                  }
                }
              ],
              "DemographicCriteriaList": [
                {}
              ],
              "Groups": []
            }
          }
        }
      ],
      "ObservationWindow": {
        "PriorDays": 0,
        "PostDays": 0
      },
      "PrimaryCriteriaLimit": {
        "Type": "First"
      }
    },
    "QualifiedLimit": {
      "Type": "First"
    },
    "ExpressionLimit": {
      "Type": "First"
    },
    "InclusionRules": [
      {
        "expression": {
          "Type": "ALL",
          "CriteriaList": [
            {
              "Criteria": {
                "LocationRegion": {}
              },
              "StartWindow": {
                "Start": {
                  "Coeff": -1
                },
                "End": {
                  "Coeff": 1
                },
                "UseEventEnd": false
              },
              "IgnoreObservationPeriod": true,
              "Occurrence": {
                "Type": 2,
                "Count": 1
              }
            },
            {
              "Criteria": {
                "ConditionOccurrence": {}
              },
              "StartWindow": {
                "Start": {
                  "Coeff": -1
                },
                "End": {
                  "Coeff": 1
                },
                "UseEventEnd": false
              },
              "Occurrence": {
                "Type": 2,
                "Count": 1
              }
            }
          ],
          "DemographicCriteriaList": [
            {
              "Age": {
                "Op": "gt"
              }
            }
          ],
          "Groups": []
        }
      }
    ],
    "CensoringCriteria": [],
    "CollapseSettings": {
      "CollapseType": "ERA",
      "EraPad": 0
    },
    "CensorWindow": {}
  }



  "CriteriaList": [
    {
      "ConditionEra": {
        "CorrelatedCriteria": {
          "Type": "ALL",
          "CriteriaList": [
            {
              "Criteria": {
                "ConditionEra": {
                  "First": true
                }
              },
              "StartWindow": {
                "Start": {
                  "Coeff": -1
                },
                "End": {
                  "Coeff": 1
                },
                "UseEventEnd": false
              },
              "EndWindow": {
                "Start": {
                  "Coeff": -1
                },
                "End": {
                  "Coeff": 1
                },
                "UseIndexEnd": true,
                "UseEventEnd": true
              },
              "IgnoreObservationPeriod": true,
              "Occurrence": {
                "Type": 2,
                "Count": 1
              }
            }
          ],
          "DemographicCriteriaList": [],
          "Groups": []
        }
      }
    }
  ],


  "required":["Type","CriteriaList","DemographicCriteriaList","Groups"],
  "defaultProperties":["Type","CriteriaList","DemographicCriteriaList","Groups"],
  "required":["Type","Count","CriteriaList","DemographicCriteriaList","Groups"],
  "defaultProperties":["Type","Count","CriteriaList","DemographicCriteriaList","Groups"],

  {
    "$ref": "http://localhost:8080/docs/correlated_criteria_range.json"
  }

  "Count":{"title":"Count","headerTemplate":"... n ocurrences: ","description":"of the following criteria. Add criterias, demographic or groups...",
    "anyOf":[
      {
        "type": "null",
        "title": "0"
      },
      {
        "type": "integer","title": "one of the following:",
        "watch": {
          "counter": "CriteriaList"
        },
        "enumSource": [
          {
            "source": "counter",
            "headerTemplate": "{{i1}}",
            "title": "{{i1}}",
            "value": "{{i1}}"
          }
        ]
      }
    ]
      },
